

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
    <title>Fix TypeError: window.matchMedia is not a function in Jest | Anthony Gonzales</title>
  
  <meta name="description" content="Learn how to emulate matchMedia in Jest for responsive design testing. Create a reusable test helper to check code at different breakpoints.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
<!-- Twitter cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site"    content="">
<meta name="twitter:creator" content="">
<meta property="og:title"   content="Fix TypeError: window.matchMedia is not a function in Jest">


<meta property="og:description" content="Learn how to emulate matchMedia in Jest for responsive design testing. Create a reusable test helper to check code at different breakpoints.">


<!-- end of Twitter cards -->


  
  <!-- Mastodon verification -->
  <link rel="me" href="https://mastodon.social/@anthonygonzales" />

  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <link rel="stylesheet" href="/css/normalize.css">
  <link rel="stylesheet" href="/css/vs.css">
  <link rel="stylesheet" href="/css/master.css">
</head>


<body itemscope itemtype="http://schema.org/WebPage" class="grid how-to-solve-match-media-is-not-a-function">
  <!--[if IE]>
      <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
    <![endif]-->

  <header class="header container max-width">
  <div class="header-inner">
    <div class="nav-logo">
      <a href="/">
        <span class="name">
          <span>A</span>
          <span>n</span>
          <span>t</span>
          <span>h</span>
          <span>o</span>
          <span>n</span>
          <span>y</span>
        </span>
        <span class="name">
          <span>G</span>
          <span>o</span>
          <span>n</span>
          <span>z</span>
          <span>a</span>
          <span>l</span>
          <span>e</span>
          <span>s</span>
        </span>
      </a>
    </div>
    <nav role="navigation">
      <ul class="main-nav">
        
          <li>
            <a href="/about">About</a>
          </li>
        
          <li>
            <a href="/blog">Blog</a>
          </li>
        
      </ul>
    </nav>
  </div>
</header>


  <div class="max-width container post" itemscope itemtype="http://schema.org/BlogPosting">
  <h1 class="post-title" itemprop="headline">Fix TypeError: window.matchMedia is not a function in Jest</h1>
  <div class="post-meta">
    <span class="hidden" itemprop="author">by Anthony Gonzales</span>
    <time class="post-timestamp" itemprop="datePublished"> February 23, 2024</time><span class="post-meta-separator">&bull;</span>
      <div class="post-lastupdated">
        Updated on <time itemprop="dateModified">July 28, 2024</time>
      </div></div>

  <div class="post-content" itemprop="articleBody">
    <p>Testing responsive designs in environments that don’t support the matchMedia
API, like Jest and jsdom, can be challenging. This necessitates a custom
implementation to ensure our React tests can accurately simulate different
viewport sizes. Fortunately, the css-mediaquery library provides an API that
closely emulates matchMedia, allowing us to create a tailored solution that
adheres to Mobile First development principles.</p>

<ul id="markdown-toc">
  <li><a href="#creating-a-custom-matchmedia-implementation" id="markdown-toc-creating-a-custom-matchmedia-implementation">Creating a custom matchMedia implementation</a></li>
  <li><a href="#utilizing-the-custom-implementation-in-tests" id="markdown-toc-utilizing-the-custom-implementation-in-tests">Utilizing the custom implementation in tests</a></li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ul>

<!--break-->
      <h2 id="creating-a-custom-matchmedia-implementation">
        
        
          Creating a custom matchMedia implementation <a href="#creating-a-custom-matchmedia-implementation" class="post-header-link"></a>
        
        
      </h2>

<p>To address the <code class="language-plaintext highlighter-rouge">TypeError: window.matchMedia is not a function</code> error, we’ll
develop a custom matchMedia function using the
<a href="https://github.com/ericf/css-mediaquery">css-mediaquery</a> library in our
testing tools. This function will not only simulate the matchMedia API but also
allow us to dynamically adjust the viewport size for our tests, following a
Mobile First approach.</p>

<p>Below is the implementation:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/testUtils/matchMedia.js</span>
<span class="k">import</span> <span class="nx">mediaQuery</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">css-mediaquery</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">beforeAll</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Set the initial/default matchMedia implementation</span>
  <span class="c1">// for Mobile First development</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">matchMedia</span> <span class="o">=</span> <span class="nx">createMatchMedia</span><span class="p">(</span><span class="mi">576</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">afterEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Reset matchMedia after each test</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">matchMedia</span> <span class="o">=</span> <span class="nx">createMatchMedia</span><span class="p">(</span><span class="mi">576</span><span class="p">);</span>
<span class="p">});</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">createMatchMedia</span><span class="p">(</span><span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">matchMedia</span> <span class="o">=</span> <span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
    <span class="na">matches</span><span class="p">:</span> <span class="nx">mediaQuery</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">width</span><span class="p">,</span>
    <span class="p">}),</span>
    <span class="na">addListener</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{},</span>
    <span class="na">removeListener</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{},</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Jest’s <a href="https://jestjs.io/docs/manual-mocks#mocking-methods-which-are-not-implemented-in-jsdom">official
recommendation</a>
suggests creating mocks for methods not implemented in jsdom, such as
matchMedia. However, we’ve chosen a different approach. While mocks are a
powerful tool, they often lead us to write tests that focus too heavily on
implementation details rather than on behavior. This can lead to brittle tests
that fail when implementation details change, even if the behavior remains
correct.</p>

<p>By avoiding mocks and instead creating a custom matchMedia function using the
css-mediaquery library, we aim to simulate the matchMedia API more faithfully.
This approach allows us to write tests that focus on the behavior of our
components across different viewport sizes, in line with Mobile First
development principles.</p>
    
      <h2 id="utilizing-the-custom-implementation-in-tests">
        
        
          Utilizing the custom implementation in tests <a href="#utilizing-the-custom-implementation-in-tests" class="post-header-link"></a>
        
        
      </h2>

<p>With our custom <code class="language-plaintext highlighter-rouge">matchMedia</code> implementation in place, we can now write tests
that simulate different viewport sizes. This enables us to verify the
responsive behavior of our components under various conditions.</p>

<p>Below is an example test suite that tests React components starting with the
mobile viewport:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">render</span><span class="p">,</span> <span class="nx">screen</span><span class="p">,</span> <span class="nx">createMatchMedia</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/testUtils</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">ResponsiveComponent</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">.</span><span class="dl">'</span><span class="p">;</span> 

<span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">displays details in mobile by default</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">ResponsiveComponent</span> <span class="o">/&gt;</span><span class="p">);</span>

  <span class="c1">// Expectations for mobile layout</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="dl">'</span><span class="s1">Mobile</span><span class="dl">'</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">displays progressively more details for tablet</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">createMatchMedia</span><span class="p">(</span><span class="mi">768</span><span class="p">);</span>
  <span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">ResponsiveComponent</span> <span class="o">/&gt;</span><span class="p">);</span>

  <span class="c1">// Expectations for tablet layout</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="dl">'</span><span class="s1">Mobile + Tablet</span><span class="dl">'</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">displays progressively more details for desktop</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">createMatchMedia</span><span class="p">(</span><span class="mi">992</span><span class="p">);</span>
  <span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">ResponsiveComponent</span> <span class="o">/&gt;</span><span class="p">);</span>

  <span class="c1">// Expectations for desktop layout</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">getByText</span><span class="p">(</span><span class="dl">'</span><span class="s1">Mobile + Tablet + Desktop</span><span class="dl">'</span><span class="p">)).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>
    
      <h2 id="conclusion">
        
        
          Conclusion <a href="#conclusion" class="post-header-link"></a>
        
        
      </h2>

<p>By leveraging the css-mediaquery library and implementing a custom <code class="language-plaintext highlighter-rouge">matchMedia</code>
function, we’ve created a flexible testing environment. This setup allows us to
simulate various viewport sizes, ensuring our responsive designs behave as
expected across different devices. This approach offers a practical workaround
for testing responsive components in jsdom, adhering to the principles of
Mobile First development.</p>

  </div>
  <div class="post-additional">
    <a href="https://github.com/antgonzales/antgonzales.github.io/edit/master/_posts/2024-02-23-how-to-solve-match-media-is-not-a-function.md" target="_blank" >Suggest a correction</a>
  </div>
</div>


  <footer class="footer container max-width">
    <div class="footer-inner">
        <div class="copyright">
            <span>&copy; 2025</span>
            Anthony Gonzales
        </div>
        <nav class="footer-nav">
            <ul class="list-naked">
                <li>
                    <a href="https://mastodon.social/@anthonygonzales" target="_blank">
                        <span class="hidden">Mastodon</span>
                        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-mastodon" viewBox="0 0 16 16">
                          <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a4 4 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522q0-1.288.66-2.046c.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764q.662.757.661 2.046z"/>
                        </svg>
                    </a>
                </li>
                <li>
                    <a href="mailto:hello@anthonygonzales.dev">
                        <span class="hidden">Email</span>
                        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-envelope-at-fill" viewBox="0 0 16 16">
                          <path d="M2 2A2 2 0 0 0 .05 3.555L8 8.414l7.95-4.859A2 2 0 0 0 14 2zm-2 9.8V4.698l5.803 3.546zm6.761-2.97-6.57 4.026A2 2 0 0 0 2 14h6.256A4.5 4.5 0 0 1 8 12.5a4.49 4.49 0 0 1 1.606-3.446l-.367-.225L8 9.586zM16 9.671V4.697l-5.803 3.546.338.208A4.5 4.5 0 0 1 12.5 8c1.414 0 2.675.652 3.5 1.671"/>
                          <path d="M15.834 12.244c0 1.168-.577 2.025-1.587 2.025-.503 0-1.002-.228-1.12-.648h-.043c-.118.416-.543.643-1.015.643-.77 0-1.259-.542-1.259-1.434v-.529c0-.844.481-1.4 1.26-1.4.585 0 .87.333.953.63h.03v-.568h.905v2.19c0 .272.18.42.411.42.315 0 .639-.415.639-1.39v-.118c0-1.277-.95-2.326-2.484-2.326h-.04c-1.582 0-2.64 1.067-2.64 2.724v.157c0 1.867 1.237 2.654 2.57 2.654h.045c.507 0 .935-.07 1.18-.18v.731c-.219.1-.643.175-1.237.175h-.044C10.438 16 9 14.82 9 12.646v-.214C9 10.36 10.421 9 12.485 9h.035c2.12 0 3.314 1.43 3.314 3.034zm-4.04.21v.227c0 .586.227.8.581.8.31 0 .564-.17.564-.743v-.367c0-.516-.275-.708-.572-.708-.346 0-.573.245-.573.791"/>
                        </svg>
                    </a>
                </li>
                <li>
                    <a href="/feed.xml">
                        <span class="hidden">RSS</span>
                        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-rss-fill" viewBox="0 0 16 16">
                          <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm1.5 2.5c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1 0-2m0 4a6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1 0-2m.5 7a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"/>
                        </svg>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</footer>


  
</body>

</html>
